import { Context, h } from 'koishi'

// 插件名称重命名
export const name = 'jx3box-macro'

// 函数名重命名
export function applyJx3boxMacro(ctx: Context) {
  // 核心映射表：简称、别名、门派名、新职业
  const aliasMap: Record<string, string> = {
    // --- 七秀 ---
    '冰心': '冰心诀', '奶秀': '云裳心经', '云裳': '云裳心经', '七秀': '冰心诀',
    // --- 万花 ---
    '花间': '花间游', '离经': '离经易道', '奶花': '离经易道', '万花': '花间游',
    // --- 纯阳 ---
    '剑纯': '太虚剑意', '气纯': '紫霞功', '纯阳': '紫霞功',
    // --- 天策 ---
    '傲血': '傲血战意', '铁牢': '铁牢律', '天策T': '铁牢律', '天策': '傲血战意',
    // --- 少林 ---
    '易筋': '易筋经', '洗髓': '洗髓经', '和尚T': '洗髓经', '少林': '易筋经', '和尚': '易筋经',
    // --- 藏剑 ---
    '问水': '问水诀', '藏剑': '问水诀',
    // --- 五毒 ---
    '毒经': '毒经', '补天': '补天诀', '奶毒': '补天诀', '五毒': '毒经',
    // --- 唐门 ---
    '惊羽': '惊羽诀', '天罗': '天罗诡道', '田螺': '天罗诡道', '唐门': '天罗诡道',
    // --- 明教 ---
    '焚影': '焚影圣诀', '明尊': '明尊琉璃体', '喵T': '明尊琉璃体', '明教': '焚影圣诀',
    // --- 丐帮 ---
    '笑尘': '笑尘诀', '丐帮': '笑尘诀',
    // --- 苍云 ---
    '分山': '分山劲', '铁骨': '铁骨衣', '苍云T': '铁骨衣', '苍云': '分山劲',
    // --- 长歌 ---
    '莫问': '莫问', '相知': '相知', '奶歌': '相知', '长歌': '莫问',
    // --- 霸刀 ---
    '北傲': '北傲诀', '霸刀': '北傲诀',
    // --- 蓬莱 ---
    '凌海': '凌海诀', '蓬莱': '凌海诀',
    // --- 凌雪阁 ---
    '隐龙': '隐龙诀', '凌雪': '隐龙诀', '凌雪阁': '隐龙诀',
    // --- 衍天宗 ---
    '太玄': '太玄经', '衍天': '太玄经', '衍天宗': '太玄经',
    // --- 北天药宗 ---
    '无方': '无方', '灵素': '灵素', '药奶': '灵素', '药宗': '无方',
    // --- 刀宗 ---
    '孤锋': '孤锋诀', '刀宗': '孤锋诀',
    // --- 万灵当歌 ---
    '山海': '山海心诀', '万灵': '山海心诀',
    // --- 段氏 ---
    '周天': '周天功', '段氏': '周天功',
    // --- 无相 ---
    '幽罗': '幽罗引', '幽罗引': '幽罗引', '无相': '幽罗引', '无相楼': '幽罗引'
  }

  ctx.command('宏 <name:string>')
    .alias('jx3macro')
    .action(async ({ session }, name) => {
      if (!name) return '请输入心法或门派名称，例如：宏 冰心 或 宏 霸刀'

      // 逻辑处理：先查别名表，查不到则直接使用输入词
      const standardName = aliasMap[name] || name
      const url = `https://www.jx3box.com/macro/?subtype=${encodeURIComponent(standardName)}`

      return [
        h('quote', { id: session?.messageId }),
        `📖 ${h('b', standardName)} · 宏仓库`,
        '━━━━━━━━━━━━━━',
        `点击链接查看魔盒最新宏：`,
        `🔗 ${url}`,
        '━━━━━━━━━━━━━━',
        `💡 提示：单门派已自动映射至其对应心法。`
      ].join('\n')
    })
}